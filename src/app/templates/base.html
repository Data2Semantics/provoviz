<!DOCTYPE html>

<html>
<head>
    <title>PROV Provenance Visualizer</title>
    <link rel="stylesheet" href="{{ url_for('.static',filename='css/bootstrap.css') }}" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="{{ url_for('.static',filename='css/bootstrap-responsive.css') }}" />
    <link rel="stylesheet" href="{{ url_for('.static',filename='css/commit.css') }}" />
    <link rel="stylesheet" href="{{ url_for('.static',filename='css/select2.css') }}" />
    <link rel="stylesheet" href="{{ url_for('.static',filename='css/select2-bootstrap.css') }}" />
    <script src="http://code.jquery.com/jquery-latest.js"></script>
    <script src="{{ url_for('.static',filename='js/jquery.storage.js') }}"></script>
	<script src="http://crypto-js.googlecode.com/svn/tags/3.1.2/build/rollups/sha1.js"></script>

    <style>
        #graph {
            color: black;
            padding: 1em;
        }
        
        body {
            overflow-x: hidden;
        }

        
        .link {
          stroke: #999;
          stroke-opacity: .6;
        }

        .node:not(:hover) .label {
          display: none;
        }

        

        
        .concept, .origin, .activity {
          font: 15px "Yanone Kaffeesatz", sans-serif;
        }

        .node rect {
            cursor: move;
            fill-opacity: .9;
            shape-rendering: crispEdges;
          }
          
          .node text {
            pointer-events: none;
            font: 10px sans-serif;
            font-weight: 100;
            font-style: normal;
            font-variant: normal;
            text-shadow: 0 1px 0 #fff;
            stroke: #414141;
            display: block;
            color: rgb(41,41,41);
          }
          
          .link {
            fill: none;
            stroke: #000;
            stroke-opacity: .1;
          }
          
          .link:hover {
            stroke-opacity: .5;
          }
              
    
        .graph {
            overflow: auto;
            padding: 1em;
        }
        
        
        
        #circle circle {
            fill: none;
            pointer-events: all;
          }
          
          .group path {
            fill-opacity: .5;
          }
          
          path.chord {
            stroke: #000;
            stroke-width: .25px;
          }
          
          #circle:hover path.fade {
            display: none;
          }
          
          .chord-label {
            font: 8px "Open Sans", sans-serif;
          }
          
          #activities-row {
            margin-bottom: 50px;
          }
    </style>
    
</head>

<body>

    <div class="container" id="#contents">
        <div class="row">
            <div class="span12">
                <div class="page-header">
                    <h1><img src="{{ url_for('.static',filename='img/logo-no-text-150dpi.png') }}"style="float: left; width: 100px;"/>PROV-O-Viz <small>Visualizing the Train of Thought</small> </h1>
                    <p>Copyright (c) 2013, Rinke Hoekstra, VU University Amsterdam</p>
                </div>
            </div>
        </div>
		
		<div class="row">
			<div class="span6">				
				<h4>About PROV-O-Viz</h4>
				<p>With PROV-O-Viz you can visualize <em>any</em> provenance graph expressed using the <a href="http://www.w3.org/TR/prov-o/" target="_blank">W3C PROV-O vocabulary</a> as an intuitive <a href="http://bost.ocks.org/mike/sankey/" target="_blank">Sankey diagram</a>. Really neat.</p>
				<p>PROV-O-Viz was developed by the <a href="http://www.data2semantics.org" target="_blank">Data2Semantics</a> project, funded under the <a href="http://www.commit-nl.nl" target="_blank">COMMIT/ programme</a>.</p>
				
			</div>
			<div class="span6">
				<h4>How to use it</h4>
				<p>To see what it does, you can point PROV-O-Viz to your own SPARQL endpoint, containing Named Graphs with PROV-O activities and entities in it.</p>
				<p>Alternatively, you can simply copy and paste some of PROV-O in Turtle format in the Paste-And-Go form.</p>

				<p>Finally, you can POST PROV-O in Turtle format to the PROV-O-Viz service, and we'll return a self-contained HTML snippet for you to include in your website.</p>
				<ul>
					<li>The service lives at <code>http://semweb.cs.vu.nl/provoviz/service</code>, and</li>
					<li>expects a POST with a <code>graph_uri</code> parameter (a URI that identifies your provenance graph), and</li>
				 	<li>a <code>data</code>	parameter that contains a Turtle serialization of a PROV-O graph</li>
				</ul>
			</div>
		</div>
		<div class="">
		<div class="row">
			<div class="span6">
                <h4>SPARQL Endpoint</h4>
                <p>Give the URL of your SPARQL endpoint</p>
                <div class="input-append">
                    <input type="text" class="span5" id="endpoint" name="endpoint" placeholder="Start typing..." width="100%"></input><button type="button" id="endpointSubmit" value="go" class="btn btn-primary">Go</input>
                </div>
			</div>
			<div class="span6">
				<h4>Paste-And-Go form</h4>
				<p>Paste a Turtle serialization of a PROV-O graph in the text area below.</p>
				<div class="input-append">
					<textarea id="provodata" class="span5" name="data" rows="4" placeholder="PROV-O input"></textarea>
					<button id="provoSubmit" class="btn btn-primary" value="go" type="button">Go</button>
				</div>
			</div>
			<div class="span6">

				<div class="alert alert-info"><strong>Example</strong>
					<p>Our own experimental endpoint at <code>http://semweb.cs.vu.nl:8080/openrdf-sesame/repositories/goldendemo</code> usually contains some PROV-O for you to explore)
					</p>
				</div>
			</div>
			<div class="span6">
				<div class="alert alert-info"><strong>Example</strong>
					<p>Use the most excellent <a href="http://git2prov.org">Git2PROV</a> we developed together with the University of Ghent to generate PROV-O from your favorite Git repository. The output of Git2PROV can simply be copied to the text area.
					</p>
				</div>
			</div>		
		</div>		
        


        <div class="row" id="explore-row">
            <div class="span12">
                <h4>Explore Graphs</h4>
                <p>When you select a Named Graph, we will retrieve a list of all activities in that graph. Only graphs with activities are shown here.</p>
                {% include 'graphs.html' %}
            </div>
        </div>
        <div class="row" id="activities-row">
            <div class="span12">
                <h4>Explore Activities</h4>
                <p>When you select an activity from the drop down box, we will render Sankey diagram showing the <strong>activity</strong> together with causally-related <strong>entities</strong> and <strong>activities</strong>.</p>
                {% include 'activities.html' %}
            </div>
        </div>
        <div class="row" id="serviceactivities">
        </div>
        {% include 'nothing_selected.html' %}
        {% include 'loading.html' %}
        {% include 'nothing_returned.html' %}
        <div class="row">
            <div class="span12">
                <div class="graph" id="graph">
                &nbsp;
                </div>
            </div>
        </div>
        <div class="row">
            <div class="span12">
                <h5>Credits</h5>
                <p>Thanks go to the most excellent <a href="http://d3js.org/">D3.js</a> library for the Sankey diagram used on this page.</p>
            </div>
        </div>
    </div>

    <script type="application/x-javascript">

        $(document).ready(function() {
            $("#loading").hide();
            $("#noresponse").hide();
            $("#explore-row").hide();
            $("#activities-row").hide();
			$("#serviceactivities").hide();	
            
            $('#endpointSubmit').on('click',function(){
            	endpointSubmit($('#endpoint').val());
            });

			$('#provoSubmit').on('click', function(){
				provoSubmit($('#provodata').val());
			});
        });

        function endpointSubmit(endpoint_uri) {
        	$("#loading").show();
            $("#noresponse").hide();
            $("#noselection").hide();
            $("#explore-row").hide();
            $("#activities-row").hide();
			$("#serviceactivities").hide();	
            
            $.localStorage('endpoint_uri',endpoint_uri);
            
            $.getJSON('{{ url_for("graphs") }}', {endpoint_uri: endpoint_uri }).done(function(data){
                console.log(data);
                
                $("#graphs").select2({ placeholder: "Start typing..." , allowClear: true, data: data.graphs });
                $("#loading").hide();
                $("#explore-row").show();
                
            });
        }

		function provoSubmit(provodata) {
			$("#loading").show();
            $("#noresponse").hide();
            $("#noselection").hide();
            $("#explore-row").hide();
            $("#activities-row").hide();
			$("#serviceactivities").hide();	

			var hash=CryptoJS.SHA1(provodata);
			
			var graph_uri = "http://prov.data2semantics.org/resource/"+hash;
			
			console.log(graph_uri);
			
			var post_data = { data: provodata, graph_uri: graph_uri };
			
			$.post('{{ url_for("service") }}', post_data, function(data){
				var div = $('<div></div>');
				div.addClass('span12');
				div.html(data);
				$("#serviceactivities").empty();
				$("#serviceactivities").append(div);
				$("#loading").hide();
				$("#serviceactivities").show();	
			})
		}

        
         
    </script>

</body>
    <script src="{{ url_for('.static',filename='js/bootstrap.js') }}"></script>
    <script src="{{ url_for('.static',filename='js/select2.js') }}"></script>
    <script src="{{ url_for('.static',filename='js/vendor/jquery.ui.widget.js') }}"></script> 
</html>
